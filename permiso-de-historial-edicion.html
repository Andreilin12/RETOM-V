<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Página de Permisos</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #34495e;
            color: #fff;
            text-align: center;
            padding: 50px;
        }
        button {
            background-color: #16a085;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            display: none; /* Ocultar por defecto */
        }
        button:hover {
            background-color: #2c3e50;
        }
        .alert {
            background: #e74c3c;
            color: #fff;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            display: none; /* Ocultar por defecto */
        }
    </style>
</head>
<body>
    <h1>Historial de Productos</h1>
    <button id="restrictedButton" onclick="window.location.href='historial-de-edicion.html'">
        <i class="fas fa-check-circle" style="font-size: 20px; color: #fff;"></i> Consultar Productos Editados
    </button>
    <div id="alert" class="alert"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
        import { getFirestore, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore.js";
        import { getAuth } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js";

        const firebaseConfig = { 
            apiKey: "AIzaSyDLi-egzQlgbKW8XV_qIhU6313Gd8gocCg",
            authDomain: "inventario-35d6b.firebaseapp.com", 
            projectId: "inventario-35d6b", 
            storageBucket: "inventario-35d6b.appspot.com",
            messagingSenderId: "266100399659",
            appId: "1:266100399659:web:92358d28cbd803c8a7d46e"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        async function checkPermissions() {
            const currentUser = auth.currentUser;

            if (!currentUser) {
                showAlert("Error: Usuario no autenticado.");
                return;
            }

            const userRef = doc(db, "users", currentUser.uid);

            // Escuchar cambios en tiempo real
            onSnapshot(userRef, (userDoc) => {
                if (userDoc.exists()) {
                    const data = userDoc.data();
                    if (data.grantedUsers && data.grantedUsers.includes(currentUser.uid)) {
                        document.getElementById("restrictedButton").style.display = "inline-block"; // Mostrar el botón
                    } else {
                        document.getElementById("restrictedButton").style.display = "none"; // Ocultar el botón
                        showAlert("No tienes permiso para realizar esta acción.");
                    }
                } else {
                    showAlert("No se encontraron datos para el usuario.");
                }
            }, (error) => {
                console.error("Error al obtener datos del usuario: ", error);
                showAlert("Ocurrió un error al verificar permisos.");
            });
        }

        function showAlert(message) {
            const alertDiv = document.getElementById("alert");
            alertDiv.innerText = message;
            alertDiv.style.display = "block"; // Mostrar la alerta
            setTimeout(() => {
                alertDiv.style.display = "none"; // Ocultar después de 5 segundos
            }, 5000);
        }

        // Verificar permisos al cargar la página
        checkPermissions();
    </script>
</body> 
</html>
